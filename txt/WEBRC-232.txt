Adding new and improving existing functional tests
